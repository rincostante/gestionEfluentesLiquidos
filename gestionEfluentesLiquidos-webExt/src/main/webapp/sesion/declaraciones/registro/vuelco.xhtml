<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui">
    <h:head>

    </h:head>
    <h:body>
        <p:growl id="messages" showDetail="false" />
        <b:modal id="dlgAyudaVuelcoInscrip" title="Registro de DJ - Vuelco - Datos registrados en DRP" styleClass="modalAyudaVuelcoInscrip"
            closable="true" >
                Ayuda vuelco, datos registrados en la DRP del MAyDS 
            <f:facet name="footer">
                <b:button value="Cerrar" dismiss="modal" onclick="return false;"/>
            </f:facet>
        </b:modal>
        
        <!-- Formulario validar DRP -->
        <b:modal id="dlgValidDrp" styleClass="modalValidDrp" closable="true" >
            <h:form prependId="false" id="frValidDrp">
                <b:panel id="pnValidDrp" title="Validar los datos del Establecimiento en la DRP" look="info" collapsible="false" >
                    <b:row>
                        <b:column span="10">
                            <b:inputText id="txtUsDrp" label="" placeholder="Ingrese el usuario DRP ([CUIT]/[numOrden])" value="#{mbDeclaraciones.usDrp}" />
                        </b:column>
                        <b:column span="2">
                            <b:commandButton id="btnValidar" action="#{mbDeclaraciones.validarUsuarioDrp()}" look="primary" icon="glyphicon-check" value=""
                                     ajax="true" update="messages,frValidDrp" />
                        </b:column>
                    </b:row>

                    <h:panelGrid columns="1" style="width: 100%" rendered="#{mbDeclaraciones.expediente.id gt 0}">
                        <b:row>
                            <b:column span="4">
                                <p:outputLabel style="font-weight: lighter; color: gray" value="N° Exp.: " />
                            </b:column>
                            <b:column span="8">
                                <b:inputText disabled="true" label="" value="#{mbDeclaraciones.expediente.expNumero}" />
                            </b:column>
                        </b:row>
                        <b:row>
                            <b:column span="4">
                                <p:outputLabel style="font-weight: lighter; color: gray" value="Año Exp.: " />
                            </b:column>
                            <b:column span="8">
                                <b:inputText disabled="true" label="" value="#{mbDeclaraciones.expediente.expAnio}" />
                            </b:column>
                        </b:row>
                        <b:row>
                            <b:column span="4">
                                <p:outputLabel style="font-weight: lighter; color: gray" value="N° CAA.: " />
                            </b:column>
                            <b:column span="8">
                                <b:inputText disabled="true" label="" value="#{mbDeclaraciones.expediente.caNumero}" />
                            </b:column>
                        </b:row>
                        <b:row>
                            <b:column span="4">
                                <p:outputLabel style="font-weight: lighter; color: gray" value="Fecha venc. CAA.: " />
                            </b:column>
                            <b:column span="8">
                                <p:calendar disabled="true" label="" value="#{mbDeclaraciones.expediente.caVencimiento.toGregorianCalendar().time}" pattern="dd/MM/yyyy" locale="es" />
                            </b:column>
                        </b:row>
                        <b:row>
                            <b:column span="4">
                                <p:outputLabel style="font-weight: lighter; color: gray" value="Us DRP: " />
                            </b:column>
                            <b:column span="8">
                                <b:inputText disabled="true" label="" value="#{mbDeclaraciones.expediente.usuario}" />
                            </b:column>
                        </b:row>
                        <b:row>
                            <b:column span="4">
                                <p:outputLabel style="font-weight: lighter; color: gray" value="Nombre Est.: " />
                            </b:column>
                            <b:column span="8">
                                <b:inputText disabled="true" label="" value="#{mbDeclaraciones.expediente.nombre}" />
                            </b:column>
                        </b:row>
                        <b:row>
                            <b:column span="4">
                                <p:outputLabel style="font-weight: lighter; color: gray" value="Descrip.: " />
                            </b:column>
                            <b:column span="8">
                                <b:inputText disabled="true" label="" value="#{mbDeclaraciones.expediente.descripcion}" />
                            </b:column>
                        </b:row>
                    </h:panelGrid>
                    <b:commandButton action="#{mbDeclaraciones.guardarDtosValidDrp}" look="primary" value="#{mbDeclaraciones.mdGuardarDatosValidDrp}" 
                                     ajax="true" update="@next,frTabVuelcos,messages" process="@this" style="margin-right: 5px" oncomplete="closeModalValidDrp()" />
                    <b:commandButton action="#{mbDeclaraciones.limpiarDatosValid}" icon="glyphicon-delete" value="#{mbDeclaraciones.mdLimpiarDatosValidDrp}" 
                                     look="warning" update="frValidDrp,frTabVuelcos" style="margin-left: 5px" />
                    <f:facet name="footer">
                        <b:button value="Cerrar" dismiss="modal" onclick="return false;"/>
                    </f:facet>
                </b:panel>
            </h:form>
        </b:modal>        
        
        <h:form id="frTabVuelcos" prependId="false">
            <b:panel title="Vuelco" look="info" collapsible="false" style="height: 100%" >
                
                <b:row>
                    <b:column span="12" >
                        <b:label tooltip="De estar inscripto, obtener los datos desde aquí" text="Inscripción registro MAyDS" severity="info"/>
                        <b:panel collapsible="false" look="info">
                            <b:button onclick="$('.modalAyudaVuelcoInscrip').modal();return false;" size="xs" look="warning" value="Ayuda" style="margin-bottom: 10px"/>
                            <b:commandButton title="Validar DRP" oncomplete="$('.modalValidDrp').modal();return false;" 
                                         size="xs" look="primary" value="#{mbDeclaraciones.mdAgregar}" icon="glyphicon-new-window" style="margin-bottom: 10px" ajax="true" />
                            <b:commandButton title="Actualizar listado" update="dtSup" ajax="true" size="xs" look="default" 
                                             value="#{mbDeclaraciones.mdActualizar}" icon="glyphicon-refresh" style="margin-bottom: 10px" >
                                <p:ajax update="frTabVuelcos" />
                            </b:commandButton> 
                            
                            <h:panelGrid columns="3" style="width: 100%" rendered="#{mbDeclaraciones.vuelco.expNum gt 0}" >
                                <b:row>
                                    <b:column span="4">
                                        <b:inputText disabled="true" label="Número Expediente DRP: " value="#{mbDeclaraciones.vuelco.expNum}" />
                                        <b:inputText disabled="true" label="Año Expediente DRP: " value="#{mbDeclaraciones.vuelco.expAnio}" />
                                    </b:column>
                                    <b:column span="4">
                                        <b:inputText disabled="true" label="Número CAA: " value="#{mbDeclaraciones.vuelco.caaNum}" />
                                        <p:calendar disabled="true" label="Fecha venc. CAA.:" value="#{mbDeclaraciones.vuelco.caaFechaVenc}" pattern="dd/MM/yyyy" locale="es" />
                                    </b:column>
                                    <b:column span="4">
                                        <b:inputText disabled="true" label="Usuario DRP: " value="#{mbDeclaraciones.vuelco.usDrp}" />
                                        <b:inputText disabled="true" label="Nombre: " value="#{mbDeclaraciones.vuelco.nombreDrp}" />
                                    </b:column>
                                </b:row>
                            </h:panelGrid>
                            <h:panelGrid columns="3" style="width: 100%" rendered="#{mbDeclaraciones.vuelco.expNum gt 0}" >
                                <b:row>
                                    <b:column span="12">
                                        <b:inputText disabled="true" label="Desc.: " value="#{mbDeclaraciones.vuelco.descDrp}" />
                                    </b:column>
                                </b:row>
                            </h:panelGrid>
                        </b:panel>
                    </b:column>
                </b:row>
                
                <b:row>
                    <!-- Circuitos -->
                    <b:column span="5" >
                        <b:label tooltip="Indique las características de los diferentes circuitos de agua" text="Características de los circuitos" severity="info"/>
                        <b:panel collapsible="false" look="info">
                            <b:row>
                                <b:column span="12" >
                                    <h:panelGrid columns="1"  cellpadding="5">
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.circCerrRefrig}" label="" caption="Circuito  cerrado de refrigeración" />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.recircAgua}" label="" caption="Recirculación de agua" />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.lavaPisosInd}" label="" caption="Lavado de pisos de locales industriales" />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.circAbierntRefrig}" label="" caption="Circuito abierto de refrigeración" />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.caldera}" label="" caption="Caldera" />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.captaAguaSubte}" label="" caption="Captación de Agua Subterránea" />
                                    </h:panelGrid>
                                </b:column>
                            </b:row>
                        </b:panel>
                    </b:column>
                    <!-- Calidad afluente -->
                    <b:column span="7" >
                        <b:label tooltip="Indique si el líquido residual crudo contiene alguna de estas sustancias" text="Calidad del Afluente" severity="info"/>
                        <b:panel collapsible="false" look="info">
                            <b:row>
                                <b:column span="6" >
                                    <h:panelGrid columns="1"  cellpadding="5">
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.arsenico}" label="" caption="Arsénico" />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.cadmio}" label="" caption="Cadmio" />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.cianuro}" label="" caption="Cianuro" />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.cromo}" label="" caption="Cromo" />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.detergentes}" label="" caption="Detergentes" />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.fenoles}" label="" caption="Fenoles" />
                                    </h:panelGrid>
                                </b:column>
                                <b:column span="6" >
                                    <h:panelGrid columns="1"  cellpadding="5">
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.hidrocarburos}" label="" caption="Hidrocarburos" />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.mercurio}" label="" caption="Mercurio" />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.plomo}" label="" caption="Plomo" />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.solventesOrg}" label="" caption="Solvente Orgánico" />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.solidosSediment}" label="" caption="S.S.E.E." />
                                        <b:selectBooleanCheckbox value="#{mbDeclaraciones.vuelco.sustSolubles}" label="" caption="Sulfuros" />
                                    </h:panelGrid>
                                </b:column>
                            </b:row>
                        </b:panel>
                    </b:column>
                </b:row>
                <!-- Características afluente -->
                <b:row>
                    <b:column span="12" >
                        <b:label tooltip="Indique el grado de acidez del afluente" text="Carcaterística del Afluente" severity="info"/>
                        <b:panel collapsible="false" look="info">
                            <b:row>
                                <b:column span="4" >
                                    <b:selectBooleanCheckbox id="chkAcido" onclick="deshabilitarNoAcido();" 
                                                             disabled="#{mbDeclaraciones.vuelco.neutro or mbDeclaraciones.vuelco.alcalino}"
                                                             value="#{mbDeclaraciones.vuelco.acido}" label="" caption="pH menor o igual a 6 ACIDO" />
                                </b:column>
                                <b:column span="4" >
                                    <b:selectBooleanCheckbox id="chkNeutro" onclick="deshabilitarNoNeutro()" 
                                                             disabled="#{mbDeclaraciones.vuelco.acido or mbDeclaraciones.vuelco.alcalino}" 
                                                             value="#{mbDeclaraciones.vuelco.neutro}" label="" caption="pH entre 6 y 8 NEUTRO" />
                                </b:column>
                                <b:column span="4" >
                                    <b:selectBooleanCheckbox id="chkAlcalino" onclick="deshabilitarNoAlcalino()" 
                                                             disabled="#{mbDeclaraciones.vuelco.neutro or mbDeclaraciones.vuelco.acido}" 
                                                             value="#{mbDeclaraciones.vuelco.alcalino}" label="" caption="pH mayor o igual a 8 ALCALINO" />
                                </b:column>
                            </b:row>
                        </b:panel>
                    </b:column>
                </b:row>
                
                <b:row>
                    <b:column span="12" >
                        <b:button onclick="$('.modalAyudaVuelcoBoolean').modal();return false;" size="sm" look="warning" value="Ayuda" />
                        <b:commandButton rendered="#{not mbDeclaraciones.datosVuelco}" 
                                         title="Guardar las carcterísticas del vuelco en la Declaración" size="sm" 
                                         action="#{mbDeclaraciones.createVuelcos()}" 
                                         look="primary" value="#{mbDeclaraciones.vlcGuardar}" ajax="true" update="frValidDrp,frTabVuelcos,messages" />
                        <b:commandButton rendered="#{not mbDeclaraciones.datosVuelco}" 
                                         title="Limpiar las características del vuelco seleccionados" size="sm" 
                                         action="#{mbDeclaraciones.limpiarVuelco()}" 
                                         look="danger" value="#{mbDeclaraciones.vlcLimpiar}" 
                                         ajax="true" update="@next,frValidDrp,frTabVuelcos,messages" />
                        <b:commandButton rendered="#{mbDeclaraciones.datosVuelco}" 
                                         title="Actualizar las caracterísicas del vuelco de la Declaración" size="sm" 
                                         action="#{mbDeclaraciones.editVuelcos()}" look="primary" 
                                         value="#{mbDeclaraciones.vlcActualizar}" ajax="true" update="messages" />
                        <b:commandButton rendered="#{mbDeclaraciones.datosVuelco}" 
                                         title="Eliminar las características del vuelco de la Declaración" size="sm" 
                                         action="#{mbDeclaraciones.deleteVuelco()}" look="danger" 
                                         value="#{mbDeclaraciones.vlcEliminar}" ajax="true" update="frValidDrp,frTabVuelcos" />
                    </b:column>
                </b:row>
                
            </b:panel>
        </h:form>
    </h:body>
    <script type="text/javascript">
        var activeAcido;
        var saveAcido;
        var activeNetutro;
        var saveNeutro;
        var activeAlcalino;
        var saveAlcalino;
        
        function deshabilitarNoAcido(){
            if(#{mbDeclaraciones.vuelco.acido}){
                saveAcido = true;
            }
            if(activeAcido){
                if(saveAcido){
                    frTabVuelcos:input_chkAlcalino.disabled = true;
                    frTabVuelcos:input_chkNeutro.disabled = true;
                    activeAcido = false;
                }else{
                    frTabVuelcos:input_chkAlcalino.disabled = false;
                    frTabVuelcos:input_chkNeutro.disabled = false;
                    activeAcido = false;
                }
            }else{
                if(saveAcido){
                    frTabVuelcos:input_chkAlcalino.disabled = false;
                    frTabVuelcos:input_chkNeutro.disabled = false;
                    activeAcido = true;
                }else{
                    frTabVuelcos:input_chkAlcalino.disabled = true;
                    frTabVuelcos:input_chkNeutro.disabled = true;
                    activeAcido = true;
                }
            }
        }
        function deshabilitarNoNeutro(){
            if(#{mbDeclaraciones.vuelco.neutro}){
                saveNeutro = true;
            }
            if(activeNetutro){
                if(saveNeutro){
                    frTabVuelcos:input_chkAlcalino.disabled = true;
                    frTabVuelcos:input_chkAcido.disabled = true;
                    activeNetutro = false;
                }else{
                    frTabVuelcos:input_chkAlcalino.disabled = false;
                    frTabVuelcos:input_chkAcido.disabled = false;
                    activeNetutro = false;
                }
            }else{
                if(saveNeutro){
                    frTabVuelcos:input_chkAlcalino.disabled = false;
                    frTabVuelcos:input_chkAcido.disabled = false;
                    activeNetutro = true;
                }else{
                    frTabVuelcos:input_chkAlcalino.disabled = true;
                    frTabVuelcos:input_chkAcido.disabled = true;
                    activeNetutro = true;
                }
            }
        }
        function deshabilitarNoAlcalino(){
            if(#{mbDeclaraciones.vuelco.alcalino}){
                saveAlcalino = true;
            }        
            if(activeAlcalino){
                if(saveAlcalino){
                    frTabVuelcos:input_chkNeutro.disabled = true;
                    frTabVuelcos:input_chkAcido.disabled = true;
                    activeAlcalino = false;
                }else{
                    frTabVuelcos:input_chkNeutro.disabled = false;
                    frTabVuelcos:input_chkAcido.disabled = false;
                    activeAlcalino = false;
                }
            }else{
                if(saveAlcalino){
                    frTabVuelcos:input_chkNeutro.disabled = false;
                    frTabVuelcos:input_chkAcido.disabled = false;
                    activeAlcalino = true;
                }else{
                    frTabVuelcos:input_chkNeutro.disabled = true;
                    frTabVuelcos:input_chkAcido.disabled = true;
                    activeAlcalino = true;
                }
            }
        }
    </script>   
</html>
