<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui">
    <h:head>

    </h:head>
    <h:body>
        <p:growl id="messages" showDetail="false" />
        <b:modal id="dlgAyudaGrales" title="Registro de DJ - Descargas" styleClass="modalAyudaDatosGrales"
            closable="true" >
            <p><h:outputLabel style="font-size: 14px; color: background; font-weight: lighter" value="Hacer click en el botón verde 'Actualizar' 
                              antes de iniciar el ingreso de datos. Debe consignar al menos una descarga."/></p>
            <p><h:outputLabel style="font-size: 14px; color: background; font-weight: lighter" value="Los establecimientos industriales o 
                              especiales que generan efluentes en sus procesos pero no producen ningún vuelco, ya sea porque acumulan los 
                              líquidos para su retiro mediante un Operador habilitado, u otros motivos, deberán adjuntar (en el ítem Adjuntar 
                              Documentos) el balance de masas correspondiente. Los establecimientos que sólo produzcan efluentes cloacales 
                              no necesitan adjuntar balance de masas."/></p>
            Las descargas declaradas y guardadas se muestran en una lista al final del formulario, 
            existiendo la opción de editarlas o borrarlas individualmente. Al finalizar la carga de información, 
            clickear el botón Guardar Descarga para guardar los datos del formulario o el botón Limpiar 
            Descargas para borrar la lista de descargas y sus datos. Para deshacer una selección del menú 
            desplegable usar el botón Cancelar selección. Una vez guardadas, podrá editarlas mientras la Declaración
            no esté firmada. Para guardar estos datos, primero deberá guardar los Datos complementarios.
            <f:facet name="footer">
                <b:button value="Cerrar" dismiss="modal" onclick="return false;"/>
            </f:facet>
        </b:modal>
        <b:modal id="dlgAyudaRegDesc" title="Registro de DJ - Descargas - Registro/Edición" styleClass="modalAyudaRegDesc"
            closable="true" >
            <p><h:outputLabel style="font-size: 14px; color: background; font-weight: lighter" 
                                  value="Tipo de Descarga: Seleccionar en el menú desplegable el tipo de descarga que efectúa el 
                                  establecimiento, ya sea cloacal, industrial o combinado (mixto) y completar la información 
                                  sobre la misma. Repetir el proceso tantas veces como descargas se efectúen, mediante el botón 
                                  Guardar Descarga. Las descargas ingresadas se mostrarán en una lista al final del formulario."/></p>
            <p><h:outputLabel style="font-size: 14px; color: background; font-weight: lighter" 
                                  value="Caudal: Se calcula el caudal diario del vertido de cada una de las descargas de la siguiente 
                                  manera: El volumen total evacuado anualmente se divide por el número de días trabajados en dicho 
                                  período. Debe ser expresado en m³/día, utilizando un punto en caso de haber decimales."/></p>
            <p><h:outputLabel style="font-size: 14px; color: background; font-weight: lighter" 
                                  value="Destino: Seleccionar el destino de cada descarga en el menú desplegable. Se identificará 
                                  expresamente en el croquis (en el ítem Adjuntar Documentos) la vía y destino final/cuerpo receptor 
                                  de la descarga de tipo industrial (coincidente con el permiso de vuelco en caso de poseer)."/></p>
            <p><h:outputLabel style="font-size: 14px; color: background; font-weight: lighter" 
                                  value="N° de Conexión: Indicar con números sucesivos y correlativos comenzando por el 1 hasta 
                                  completar el número de descargas que posea el establecimiento."/></p>
            <p><h:outputLabel style="font-size: 14px; color: background; font-weight: lighter" 
                                  value="Mayor de 5 km: Marcar sólo en el caso de efectuar la descarga en un curso de agua, y 
                                  que la misma se encuentre a una distancia mayor a 5 km."/></p>
            <p><h:outputLabel style="font-size: 14px; color: background; font-weight: lighter" 
                                  value="Anulado: Marcar sólo en el caso que alguno de los desagües informados anteriormente 
                                  haya sido anulado, cortado o desafectado."/></p>
            <p><h:outputLabel style="font-size: 14px; color: background; font-weight: lighter" 
                                  value="CTM y MC reg.: Marcar sólo en caso de poseer Cámara de Toma de Muestras y Medición de 
                                  Caudales conforme lo normado en la Resolución SAyDS N° 607/2012. "/></p>
            <p><h:outputLabel style="font-size: 14px; color: background; font-weight: lighter" 
                                  value="Tipo de Aforo: Seleccionar en el menú desplegable el tipo de aforo utilizado para medir 
                                  el caudal de cada descarga."/></p>
            <p><h:outputLabel style="font-size: 14px; color: background; font-weight: lighter" 
                                  value="Motivo de Anulación: En caso de haber marcado como “Anulado” alguna de las descargas 
                                  declaradas, explicar el motivo, indicando la fecha y el organismo interviniente, en caso de corresponder."/></p>

            <f:facet name="footer">
                <b:button value="Cerrar" dismiss="modal" onclick="return false;"/>
            </f:facet>
        </b:modal>
        <b:modal id="dlgAyudaDescListado" title="Registro de DJ - Descargas - Tratamientos" styleClass="modalAyudaDescListado"
            closable="true" >
            <p><h:outputLabel style="font-size: 14px; color: background; font-weight: lighter" 
                                  value="Tratamiento: Seleccionar del menú desplegable el tipo de tratamiento 
                                  general aplicado a cada una de las descargas declaradas."/></p>
            <p><h:outputLabel style="font-size: 14px; color: background; font-weight: lighter" 
                                  value="Tipo de Tratamiento: Seleccionar del menú desplegable el tipo de 
                                  tratamiento específico aplicado según corresponda."/></p>
            <p><h:outputLabel style="font-size: 14px; color: background; font-weight: lighter" 
                                  value="Se podrán agregar y/o editar Tratamientos a las Descargas tanto durante su 
                                  registro como durante su edición. Para ver los tratamientos vinculados a una descarga, 
                                  deberá seleccionarse la misma. El guardado de los tratamientos deberá ser previo al 
                                  guardado de cada descarga."/></p>
            <f:facet name="footer">
                <b:button value="Cerrar" dismiss="modal" onclick="return false;"/>
            </f:facet>
        </b:modal>
   
        <b:panel title="Descargas" look="info" collapsible="false">
            <h:form id="frActDesc" prependId="false">
                <b:row>
                    <b:column span="12" >
                        <b:commandButton icon="glyphicon-refresh" update="frActDesc,frDesc,frTrat,frDtDesc,frBtDesc" value="Actualizar" look="success" title="Actualizar para la carga"/>
                    </b:column>
                </b:row>
            </h:form>    
            <b:label tooltip="Utilice este formulario para ingresar los datos de nuevas descargas o actualizar las ya cargadas." 
                     text="Ingreso de Descargas nuevas o edición de existentes" severity="info"/>
            <b:panel id="pnFrom" look="info">
                <h:form id="frDesc" prependId="false">
                    <b:row>
                        <b:column span="4">
                            <b:selectOneMenu label="Tipo de Descarga" id="pepe" value="#{mbDeclaraciones.descarga.claveTipo}" >
                                <f:selectItem itemLabel="(Seleccionar)" itemValue="" noSelectionOption="true" />  
                                <f:selectItems value="#{mbDeclaraciones.mapTipoDescarga.entrySet()}" var="tipoDesc" 
                                               itemLabel="#{tipoDesc.value}" itemValue="#{tipoDesc.key}" />
                            </b:selectOneMenu>
                        </b:column>
                    </b:row>
                    <b:row>
                        <b:column span="3">
                            <b:inputText label="Caudal (m3/día)" value="#{mbDeclaraciones.descarga.caudal}" >
                                <f:validateDoubleRange />
                                <f:validateLongRange minimum="1"/>
                            </b:inputText>
                        </b:column>
                        <b:column span="6">
                            <b:selectOneMenu label="Destino" id="cmbDestEdit" value="#{mbDeclaraciones.descarga.curso}" >
                                <f:selectItem itemLabel="(Seleccionar)" itemValue="" noSelectionOption="true" />  
                                <f:selectItems value="#{mbDeclaraciones.lstDestinos}" var="curso" 
                                               itemLabel="#{curso.nombre} - #{curso.cuenca}" itemValue="#{curso}" />
                            </b:selectOneMenu>
                        </b:column>
                        <b:column span="3">
                            <b:inputText label="N° de Conexión" value="#{mbDeclaraciones.descarga.numOrden}" >
                                <f:validateLongRange minimum="1"/>
                            </b:inputText>
                        </b:column>
                    </b:row>
                    <b:row>
                        <b:column span="2">
                            <b:selectBooleanCheckbox value="#{mbDeclaraciones.descarga.mayor5km}" label="Mayor de 5 km" caption="" />
                        </b:column>
                        <b:column span="2">
                            <b:selectBooleanCheckbox value="#{mbDeclaraciones.descarga.anulado}" label="Anulado" caption="" />
                        </b:column>
                        <b:column span="2">
                            <b:selectBooleanCheckbox value="#{mbDeclaraciones.descarga.camTomaMuestra}" label="CTM y MC reg." caption="" />
                        </b:column>

                        <b:column span="6">
                            <b:selectOneMenu label="Tipo de Aforo" id="cmbAf" value="#{mbDeclaraciones.descarga.aforo}" >
                                <f:selectItem itemLabel="(Seleccionar)" itemValue="" noSelectionOption="true" />  
                                <f:selectItems value="#{mbDeclaraciones.lstAforos}" var="aforo" 
                                               itemLabel="#{aforo.nombre}" itemValue="#{aforo}" />
                            </b:selectOneMenu>
                        </b:column>
                    </b:row>
                    <b:row>
                        <b:column span="12">
                            <p:inputTextarea id="txMotAnulado" value="#{mbDeclaraciones.descarga.motivoAnulado}" style="font-weight: lighter; color: gray"
                                             styleClass="form-control bf-no-message" label="Motivo de anulación/líquidos acumulados o retirados." 
                                             placeholder="Detalle brevemento los motivos de la anulación, si existieran y los líquidos acumulados o retirados en caso de corresponder." maxlength="500" />
                        </b:column>
                    </b:row>
                    <br></br>
                    <b:row>
                        <b:column span="12" >
                            <b:button title="Breve explicación del proceso de registro de una descarga" onclick="$('.modalAyudaRegDesc').modal();return false;" size="xs" look="warning" value="Ayuda" />
                            <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Agregar la descarga nueva o guardar la actualización de una existente" 
                                             icon="glyphicon-ok" action="#{mbDeclaraciones.addDescargas()}" size="xs" look="primary" 
                                             value="#{mbDeclaraciones.vlcGuardarDescargas}" ajax="true" update="frDesc,frDtDesc,pnTrat,messages" />
                            <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Limpiar los datos ingresados sin guardar o deshacer los cambios de la acutalización" 
                                             icon="glyphicon-remove-circle" size="xs" look="danger" value="#{mbDeclaraciones.mdLimpiar}" 
                                             action="#{mbDeclaraciones.limpiarDescarga()}" update="pnFrom" />
                            <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Cancelar la selección de la descarga para su actualización" size="xs" 
                                             icon="glyphicon-minus-sign" value="#{mbDeclaraciones.gralCancelarSel}" 
                                             action="#{mbDeclaraciones.cancelarDescargaSel()}" update="pnFrom,frDesc,frDtDesc,pnTrat" />
                        </b:column>
                    </b:row>
                </h:form>
                <br></br>
                <!-- Formulario Tratamientos líquidos -->
                <b:label tooltip="Utilice este formulario para ingresar los tratamientos asociados a la descarga" 
                     text="Ingrese aquí los tratamientos de los líquidos" severity="info"/>
                <b:panel id="pnTrat" look="info" collapsible="false" >
                    <h:form prependId="false" id="frTrat">
                        <b:row>
                            <b:column span="6">
                                <b:selectOneMenu onchange="ajax:mbDeclaraciones.tipoTratChangeListener()" label="Tratamiento" id="cmbTipoTrat" 
                                                 value="#{mbDeclaraciones.tratamiento.claveNombre}" >
                                    <f:selectItem itemLabel="(Seleccionar)" itemValue="" noSelectionOption="true" />  
                                    <f:selectItems value="#{mbDeclaraciones.mapTipoTratamiento.entrySet()}" var="tipoTrat" 
                                                   itemLabel="#{tipoTrat.value}" itemValue="#{tipoTrat.key}" />
                                    <p:ajax event="change" update="cmbValorTipoTrat"/>
                                </b:selectOneMenu>
                            </b:column>
                            <b:column span="6">
                                <b:selectOneMenu label="Tipo de tratamiento" id="cmbValorTipoTrat" value="#{mbDeclaraciones.valorTipoTrat}" >
                                    <f:selectItem itemLabel="(Seleccionar)" itemValue="" noSelectionOption="true" />  
                                    <f:selectItems value="#{mbDeclaraciones.mapValoresTrat.entrySet()}" var="valTrat" 
                                                   itemLabel="#{valTrat.value}" itemValue="#{valTrat.key}" />
                                </b:selectOneMenu>
                            </b:column>
                        </b:row>
                        <b:row>
                            <b:column>
                                <b:button title="Breve explicación del proceso de registro de Tratamientos" size="xs" value="Ayuda" look="warning" onclick="$('.modalAyudaDescListado').modal();return false;" />
                                <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Guardar el Tratamiento definido" 
                                                 icon="glyphicon-ok" action="#{mbDeclaraciones.addTratamientos}" look="primary" 
                                                 value="#{mbDeclaraciones.vlcGuardarTrat}" ajax="true" size="xs"
                                                 update="@next,frTrat,dtTratamientos,messages" />
                                <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Vaciar el listado de Tratamientos definidos para la Descarga" 
                                                 action="#{mbDeclaraciones.removeTratamientos()}" icon="glyphicon-trash" 
                                                 value="#{mbDeclaraciones.mdLimpiarTodo}" size="xs"
                                                 look="danger" process="@this" ajax="true" update="frTrat" />
                                <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" icon="glyphicon-minus-sign" 
                                                 title="Cancelar la selección de la descarga para su actualización" size="xs" 
                                                 value="#{mbDeclaraciones.gralCancelarSel}" 
                                                 action="#{mbDeclaraciones.cancelarTratSel()}" update="frTrat" />
                                <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" icon="glyphicon-remove-circle" 
                                                 title="Limpiar los datos ingresados sin guardar o deshacer los cambios de la acutalización" 
                                                 size="xs" look="danger" value="#{mbDeclaraciones.mdLimpiar}" 
                                                 action="#{mbDeclaraciones.limpiarTratamiento()}" update="frTrat" />
                            </b:column>
                        </b:row>
                        <br></br>
                        <p:dataTable id="dtTratamientos" value="#{mbDeclaraciones.descarga.tratamientos}" var="tratamiento" 
                                     style="font-size: 12px" >
                            <p:column headerText="Tratamiento" >
                                <p:outputLabel style="font-weight: lighter" value="#{tratamiento.nombre}"/>
                            </p:column>
                            <p:column headerText="Tipo" >
                                <p:outputLabel style="font-weight: lighter" value="#{tratamiento.tratado}" />
                            </p:column>
                            <p:column headerText="Acciones" >
                                <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Editar" 
                                                 look="warning" ajax="true" size="xs" value="" icon="glyphicon-pencil" 
                                                 action="#{mbDeclaraciones.editTratamiento()}" >
                                    <f:setPropertyActionListener value="#{tratamiento}" target="#{mbDeclaraciones.tratamiento}" />  
                                    <p:ajax process="@this" />
                                </b:commandButton>
                                <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Eliminar" 
                                                 look="danger" ajax="true" size="xs" value="" icon="glyphicon-trash" 
                                                 action="#{mbDeclaraciones.removeTratamiento()}" update="frTrat" >
                                    <f:setPropertyActionListener value="#{tratamiento}" target="#{mbDeclaraciones.tratamiento}" />  
                                    <p:ajax process="@this" />
                                </b:commandButton>
                            </p:column>
                        </p:dataTable>
                    </h:form>
                </b:panel>
                <!-- FIN Formulario Tratamientos líquidos -->
            </b:panel>

            <b:label tooltip="Podrá seleccionar una Descarga del listado para su eliminación o edición." 
                     text="Listado de Descargas ingresadas" severity="info"/>
            <b:panel id="pnTable" look="info">
                <h:form id="frDtDesc" prependId="false">
                    <b:row>
                        <b:column span="12" >
                            <b:dataTable id="dtTrat" value="#{mbDeclaraciones.lstDescargas}" var="desc" 
                                         styleClass="table table-striped table-bordered" style="font-size: 12px" >
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Tipo" />
                                  </f:facet>
                                    <h:outputText value="#{desc.tipo}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="N°" />
                                  </f:facet>
                                    <h:outputText value="#{desc.numOrden}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Caudal (m3)" />
                                  </f:facet>
                                  <h:outputText value="#{desc.caudal}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Destino" />
                                  </f:facet>
                                  <h:outputText value="#{desc.curso.nombre}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Mayor a 5km" />
                                  </f:facet>
                                  <h:outputText value="#{desc.mayor5km}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Anulado" />
                                  </f:facet>
                                  <h:outputText value="#{desc.anulado}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Tiene CTM" />
                                  </f:facet>
                                  <h:outputText value="#{desc.camTomaMuestra}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Aforo" />
                                  </f:facet>
                                  <h:outputText value="#{desc.aforo.nombre}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Acciones" />
                                  </f:facet>
                                    <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Editar" 
                                                     look="warning" ajax="true" size="xs" value="" icon="glyphicon-pencil" 
                                                     action="#{mbDeclaraciones.editDescarga()}" update="frDesc,pnTrat" >
                                        <f:setPropertyActionListener value="#{desc}" target="#{mbDeclaraciones.descarga}" /> 
                                        <p:ajax process="@this" />
                                    </b:commandButton>
                                    <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Eliminar" 
                                                     look="danger" ajax="true" size="xs" value="" icon="glyphicon-trash" 
                                                     action="#{mbDeclaraciones.removeDescarga()}" update="frDesc,frDtDesc,frTrat" >
                                        <f:setPropertyActionListener value="#{desc}" target="#{mbDeclaraciones.descarga}" />  
                                        <p:ajax process="@this" />
                                    </b:commandButton>
                                </h:column>
                            </b:dataTable>
                        </b:column>
                    </b:row>
                </h:form>
            </b:panel>
            <h:form id="frBtDesc" prependId="false">
                <b:row>
                    <b:column span="12" >
                        <b:button title="Breve explicación del proceso de configuración de las descargas del Vuelco del Establecimiento" 
                                  onclick="$('.modalAyudaDatosGrales').modal();return false;" size="sm" look="warning" value="Ayuda" />
                        <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" rendered="#{not mbDeclaraciones.datosDescargas}" 
                                         title="Guardar las descargas configuradas en el Vuelco de la Declaración" size="sm" 
                                         icon="glyphicon-ok" action="#{mbDeclaraciones.createDescargas()}" 
                                         look="primary" value="#{mbDeclaraciones.dscGuardarDesc}" ajax="true" 
                                         update="frNav,messages,frDesc,frDtDesc,frBtDesc" process="@this" />
                        <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" icon="glyphicon-trash" rendered="#{not mbDeclaraciones.datosDescargas}" 
                                         title="Limpiar las descargas configuradas en el Vuelco de la Declaración" size="sm" 
                                         action="#{mbDeclaraciones.limpiarDescargas()}" process="@this"  
                                         look="danger" value="#{mbDeclaraciones.dscLimpiarDesc}" ajax="true" 
                                         update="frDesc,frDtDesc,frBtDesc" />
                        <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" icon="glyphicon-ok" rendered="#{mbDeclaraciones.datosDescargas}" 
                                         title="Actualizar las descargas configuradas en el Vuelco de la Declaración" size="sm" 
                                         action="#{mbDeclaraciones.editDescargas()}" look="primary" process="@this"
                                         value="#{mbDeclaraciones.dscActualizarDesc}" ajax="true" update="messages" />
                        <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" icon="glyphicon-trash" rendered="#{mbDeclaraciones.datosDescargas}" 
                                         title="Eliminar las descargas del Vuelco de la Declaración" size="sm" 
                                         action="#{mbDeclaraciones.deleteDescargas()}" look="danger" process="@this" 
                                         value="#{mbDeclaraciones.dscEliminar}" ajax="true" 
                                         update="frNav,frDesc,frDtDesc,frBtDesc" />
                    </b:column>
                </b:row>
            </h:form>
        </b:panel>
    </h:body>
</html>


