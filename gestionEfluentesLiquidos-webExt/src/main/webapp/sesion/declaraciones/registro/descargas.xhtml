<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui">
    <h:head>

    </h:head>
    <h:body>
        <p:growl id="messages" showDetail="false" />
        <b:modal id="dlgAyudaGrales" title="Registro de DJ - Datos Generales" styleClass="modalAyudaDatosGrales"
            closable="true" >
                #{bundle.ayudaDatosGrales}
            <f:facet name="footer">
                <b:button value="Cerrar" dismiss="modal" onclick="return false;"/>
            </f:facet>
        </b:modal>
        <b:modal id="dlgAyudaRegDesc" title="Registro de DJ - Descargas - Registro/Edición" styleClass="modalAyudaRegDesc"
            closable="true" >
                Ayuda descargas, registro sobre el registros de descargas nuevas y/o edición de descargas ya creadas.
            <f:facet name="footer">
                <b:button value="Cerrar" dismiss="modal" onclick="return false;"/>
            </f:facet>
        </b:modal>
        <b:modal id="dlgAyudaDescListado" title="Registro de DJ - Descargas -Listado" styleClass="modalAyudaDescListado"
            closable="true" >
                Ayuda descargas, listado de descargas vinculadas al vuelco
            <f:facet name="footer">
                <b:button value="Cerrar" dismiss="modal" onclick="return false;"/>
            </f:facet>
        </b:modal>
   
        <b:panel title="Descargas" look="info" collapsible="false">
            <h:form id="frActDesc" prependId="false">
                <b:row>
                    <b:column span="12" >
                        <b:commandButton icon="glyphicon-refresh" update="frActDesc,frDesc,frTrat,frDtDesc,frBtDesc" value="Actualizar" look="success" title="Actualizar para la carga"/>
                    </b:column>
                </b:row>
            </h:form>    
            <b:label tooltip="Utilice este formulario para ingresar los datos de nuevas descargas o actualizar las ya cargadas." 
                     text="Ingreso de Descargas nuevas o edición de existentes" severity="info"/>
            <b:panel id="pnFrom" look="info">
                <h:form id="frDesc" prependId="false">
                    <b:row>
                        <b:column span="4">
                            <b:selectOneMenu label="Tipo de Descarga" id="pepe" value="#{mbDeclaraciones.descarga.claveTipo}" >
                                <f:selectItem itemLabel="(Seleccionar)" itemValue="" noSelectionOption="true" />  
                                <f:selectItems value="#{mbDeclaraciones.mapTipoDescarga.entrySet()}" var="tipoDesc" 
                                               itemLabel="#{tipoDesc.value}" itemValue="#{tipoDesc.key}" />
                            </b:selectOneMenu>
                        </b:column>
                    </b:row>
                    <b:row>
                        <b:column span="3">
                            <b:inputText label="Caudal (m3/día)" value="#{mbDeclaraciones.descarga.caudal}" >
                                <f:validateDoubleRange />
                                <f:validateLongRange minimum="1"/>
                            </b:inputText>
                        </b:column>
                        <b:column span="6">
                            <b:selectOneMenu label="Destino" id="cmbDestEdit" value="#{mbDeclaraciones.descarga.curso}" >
                                <f:selectItem itemLabel="(Seleccionar)" itemValue="" noSelectionOption="true" />  
                                <f:selectItems value="#{mbDeclaraciones.lstDestinos}" var="curso" 
                                               itemLabel="#{curso.nombre} - #{curso.cuenca}" itemValue="#{curso}" />
                            </b:selectOneMenu>
                        </b:column>
                        <b:column span="3">
                            <b:inputText label="N° de Conexión" value="#{mbDeclaraciones.descarga.numOrden}" >
                                <f:validateLongRange minimum="1"/>
                            </b:inputText>
                        </b:column>
                    </b:row>
                    <b:row>
                        <b:column span="2">
                            <b:selectBooleanCheckbox value="#{mbDeclaraciones.descarga.mayor5km}" label="Mayor de 5 km" caption="" />
                        </b:column>
                        <b:column span="2">
                            <b:selectBooleanCheckbox value="#{mbDeclaraciones.descarga.anulado}" label="Anulado" caption="" />
                        </b:column>
                        <b:column span="2">
                            <b:selectBooleanCheckbox value="#{mbDeclaraciones.descarga.camTomaMuestra}" label="CTM y MC reg." caption="" />
                        </b:column>

                        <b:column span="6">
                            <b:selectOneMenu label="Tipo de Aforo" id="cmbAf" value="#{mbDeclaraciones.descarga.aforo}" >
                                <f:selectItem itemLabel="(Seleccionar)" itemValue="" noSelectionOption="true" />  
                                <f:selectItems value="#{mbDeclaraciones.lstAforos}" var="aforo" 
                                               itemLabel="#{aforo.nombre}" itemValue="#{aforo}" />
                            </b:selectOneMenu>
                        </b:column>
                    </b:row>
                    <b:row>
                        <b:column span="12">
                            <p:inputTextarea id="txMotAnulado" value="#{mbDeclaraciones.descarga.motivoAnulado}" style="font-weight: lighter; color: gray"
                                             styleClass="form-control bf-no-message" label="Motivo de anulación" 
                                             placeholder="En caso de estar anulada, explique el motivo brevemente." maxlength="500" />
                        </b:column>
                    </b:row>
                    <br></br>
                    <b:row>
                        <b:column span="12" >
                            <b:button title="Breve explicación del proceso de registro de una descarga" onclick="$('.modalAyudaRegDesc').modal();return false;" size="xs" look="warning" value="Ayuda" />
                            <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Agregar la descarga nueva o guardar la actualización de una existente" 
                                             icon="glyphicon-ok" action="#{mbDeclaraciones.addDescargas()}" size="xs" look="primary" 
                                             value="#{mbDeclaraciones.vlcGuardarDescargas}" ajax="true" update="frDesc,frDtDesc,pnTrat,messages" />
                            <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Limpiar los datos ingresados sin guardar o deshacer los cambios de la acutalización" 
                                             icon="glyphicon-remove-circle" size="xs" look="danger" value="#{mbDeclaraciones.mdLimpiar}" 
                                             action="#{mbDeclaraciones.limpiarDescarga()}" update="pnFrom" />
                            <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Cancelar la selección de la descarga para su actualización" size="xs" 
                                             icon="glyphicon-minus-sign" value="#{mbDeclaraciones.gralCancelarSel}" 
                                             action="#{mbDeclaraciones.cancelarDescargaSel()}" update="pnFrom,frDesc,frDtDesc,pnTrat" />
                        </b:column>
                    </b:row>
                </h:form>
                <br></br>
                <!-- Formulario Tratamientos líquidos -->
                <b:panel id="pnTrat" title="Ingrese aquí los tratamientos de los líquidos" look="info" collapsible="false" >
                    <h:form prependId="false" id="frTrat">
                        <b:row>
                            <b:column span="6">
                                <b:selectOneMenu onchange="ajax:mbDeclaraciones.tipoTratChangeListener()" label="Tratamiento" id="cmbTipoTrat" 
                                                 value="#{mbDeclaraciones.tratamiento.claveNombre}" >
                                    <f:selectItem itemLabel="(Seleccionar)" itemValue="" noSelectionOption="true" />  
                                    <f:selectItems value="#{mbDeclaraciones.mapTipoTratamiento.entrySet()}" var="tipoTrat" 
                                                   itemLabel="#{tipoTrat.value}" itemValue="#{tipoTrat.key}" />
                                    <p:ajax event="change" update="cmbValorTipoTrat"/>
                                </b:selectOneMenu>
                            </b:column>
                            <b:column span="6">
                                <b:selectOneMenu label="Tipo de tratado" id="cmbValorTipoTrat" value="#{mbDeclaraciones.valorTipoTrat}" >
                                    <f:selectItem itemLabel="(Seleccionar)" itemValue="" noSelectionOption="true" />  
                                    <f:selectItems value="#{mbDeclaraciones.mapValoresTrat.entrySet()}" var="valTrat" 
                                                   itemLabel="#{valTrat.value}" itemValue="#{valTrat.key}" />
                                </b:selectOneMenu>
                            </b:column>
                        </b:row>
                        <b:row>
                            <b:column>
                                <b:button title="Breve explicación del proceso de registro de Tratamientos" size="xs" value="Ayuda" look="warning" onclick="ayudaTrat()" />
                                <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Guardar el Tratamiento definido" 
                                                 icon="glyphicon-ok" action="#{mbDeclaraciones.addTratamientos}" look="primary" 
                                                 value="#{mbDeclaraciones.vlcGuardarTrat}" ajax="true" size="xs"
                                                 update="@next,frTrat,dtTratamientos,messages" />
                                <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Vaciar el listado de Tratamientos definidos para la Descarga" 
                                                 action="#{mbDeclaraciones.removeTratamientos()}" icon="glyphicon-trash" 
                                                 value="#{mbDeclaraciones.mdLimpiarTodo}" size="xs"
                                                 look="danger" process="@this" ajax="true" update="frTrat" />
                                <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" icon="glyphicon-minus-sign" 
                                                 title="Cancelar la selección de la descarga para su actualización" size="xs" 
                                                 value="#{mbDeclaraciones.gralCancelarSel}" 
                                                 action="#{mbDeclaraciones.cancelarTratSel()}" update="frTrat" />
                                <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" icon="glyphicon-remove-circle" 
                                                 title="Limpiar los datos ingresados sin guardar o deshacer los cambios de la acutalización" 
                                                 size="xs" look="danger" value="#{mbDeclaraciones.mdLimpiar}" 
                                                 action="#{mbDeclaraciones.limpiarTratamiento()}" update="frTrat" />
                            </b:column>
                        </b:row>
                        <br></br>
                        <p:dataTable id="dtTratamientos" value="#{mbDeclaraciones.descarga.tratamientos}" var="tratamiento" 
                                     style="font-size: 12px" >
                            <p:column headerText="Tratamiento" >
                                <p:outputLabel style="font-weight: lighter" value="#{tratamiento.nombre}"/>
                            </p:column>
                            <p:column headerText="Tipo" >
                                <p:outputLabel style="font-weight: lighter" value="#{tratamiento.tratado}" />
                            </p:column>
                            <p:column headerText="Acciones" >
                                <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Editar" 
                                                 look="warning" ajax="true" size="xs" value="" icon="glyphicon-pencil" 
                                                 action="#{mbDeclaraciones.editTratamiento()}" >
                                    <f:setPropertyActionListener value="#{tratamiento}" target="#{mbDeclaraciones.tratamiento}" />  
                                    <p:ajax process="@this" />
                                </b:commandButton>
                                <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Eliminar" 
                                                 look="danger" ajax="true" size="xs" value="" icon="glyphicon-trash" 
                                                 action="#{mbDeclaraciones.removeTratamiento()}" update="frTrat" >
                                    <f:setPropertyActionListener value="#{tratamiento}" target="#{mbDeclaraciones.tratamiento}" />  
                                    <p:ajax process="@this" />
                                </b:commandButton>
                            </p:column>
                        </p:dataTable>
                    </h:form>
                </b:panel>
                <!-- FIN Formulario Tratamientos líquidos -->
            </b:panel>

            <b:label tooltip="Podrá seleccionar una Descarga del listado para su eliminación o edición." 
                     text="Listado de Descargas ingresadas" severity="info"/>
            <b:panel id="pnTable" look="info">
                <h:form id="frDtDesc" prependId="false">
                    <b:row>
                        <b:column span="12" >
                            <b:dataTable id="dtTrat" value="#{mbDeclaraciones.lstDescargas}" var="desc" 
                                         styleClass="table table-striped table-bordered" style="font-size: 12px" >
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Tipo" />
                                  </f:facet>
                                    <h:outputText value="#{desc.tipo}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="N°" />
                                  </f:facet>
                                    <h:outputText value="#{desc.numOrden}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Caudal (m3)" />
                                  </f:facet>
                                  <h:outputText value="#{desc.caudal}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Destino" />
                                  </f:facet>
                                  <h:outputText value="#{desc.curso.nombre}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Mayor a 5km" />
                                  </f:facet>
                                  <h:outputText value="#{desc.mayor5km}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Anulado" />
                                  </f:facet>
                                  <h:outputText value="#{desc.anulado}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Tiene CTM" />
                                  </f:facet>
                                  <h:outputText value="#{desc.camTomaMuestra}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Aforo" />
                                  </f:facet>
                                  <h:outputText value="#{desc.aforo.nombre}" />
                                </h:column>
                                <h:column>
                                  <f:facet name="header">
                                    <h:outputText value="Acciones" />
                                  </f:facet>
                                    <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Editar" 
                                                     look="warning" ajax="true" size="xs" value="" icon="glyphicon-pencil" 
                                                     action="#{mbDeclaraciones.editDescarga()}" update="frDesc,pnTrat" >
                                        <f:setPropertyActionListener value="#{desc}" target="#{mbDeclaraciones.descarga}" /> 
                                        <p:ajax process="@this" />
                                    </b:commandButton>
                                    <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" title="Eliminar" 
                                                     look="danger" ajax="true" size="xs" value="" icon="glyphicon-trash" 
                                                     action="#{mbDeclaraciones.removeDescarga()}" update="frDesc,frDtDesc,frTrat" >
                                        <f:setPropertyActionListener value="#{desc}" target="#{mbDeclaraciones.descarga}" />  
                                        <p:ajax process="@this" />
                                    </b:commandButton>
                                </h:column>
                            </b:dataTable>
                        </b:column>
                    </b:row>
                </h:form>
            </b:panel>
            <h:form id="frBtDesc" prependId="false">
                <b:row>
                    <b:column span="12" >
                        <b:button title="Breve explicación del proceso de configuración de las descargas del Vuelco del Establecimiento" 
                                  onclick="$('.modalAyudaDescListado').modal();return false;" size="sm" look="warning" value="Ayuda" />
                        <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" rendered="#{not mbDeclaraciones.datosDescargas}" 
                                         title="Guardar las descargas configuradas en el Vuelco de la Declaración" size="sm" 
                                         icon="glyphicon-ok" action="#{mbDeclaraciones.createDescargas()}" 
                                         look="primary" value="#{mbDeclaraciones.dscGuardarDesc}" ajax="true" 
                                         update="frNav,messages,frDesc,frDtDesc,frBtDesc" process="@this" />
                        <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" icon="glyphicon-trash" rendered="#{not mbDeclaraciones.datosDescargas}" 
                                         title="Limpiar las descargas configuradas en el Vuelco de la Declaración" size="sm" 
                                         action="#{mbDeclaraciones.limpiarDescargas()}" process="@this"  
                                         look="danger" value="#{mbDeclaraciones.dscLimpiarDesc}" ajax="true" 
                                         update="frDesc,frDtDesc,frBtDesc" />
                        <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" icon="glyphicon-ok" rendered="#{mbDeclaraciones.datosDescargas}" 
                                         title="Actualizar las descargas configuradas en el Vuelco de la Declaración" size="sm" 
                                         action="#{mbDeclaraciones.editDescargas()}" look="primary" process="@this"
                                         value="#{mbDeclaraciones.dscActualizarDesc}" ajax="true" update="messages" />
                        <b:commandButton disabled="#{mbDeclaraciones.declaracion.firmante ne null}" icon="glyphicon-trash" rendered="#{mbDeclaraciones.datosDescargas}" 
                                         title="Eliminar las descargas del Vuelco de la Declaración" size="sm" 
                                         action="#{mbDeclaraciones.deleteDescargas()}" look="danger" process="@this" 
                                         value="#{mbDeclaraciones.dscEliminar}" ajax="true" 
                                         update="frNav,frDesc,frDtDesc,frBtDesc" />
                    </b:column>
                </b:row>
            </h:form>
        </b:panel>
    </h:body>
</html>


